# Contributing to DuckDB Entity Framework Core Integration

> **TL;DR** â€” Fork âžœ create a feature branch âžœ write code & tests âžœ run `dotnet test && dotnet format` âžœ open a pull-request.

Thank you for your interest in helping make the DuckDB + Entity Framework Core integration better! This document explains how to get the project running locally, the conventions we follow, and what we look for in a pull-request.

---

## Table of Contents

1. [Code of Conduct](#code-of-conduct)
2. [Prerequisites](#prerequisites)
3. [Development Setup](#development-setup)
4. [Branch & Commit Conventions](#branch--commit-conventions)
5. [Coding Guidelines](#coding-guidelines)
6. [SQL Rewrite Rules](#sql-rewrite-rules)
7. [Testing Guidelines](#testing-guidelines)
8. [Pull-Request Checklist](#pull-request-checklist)

---

## Code of Conduct

This project adheres to the principles of the [Contributor Covenant](https://www.contributor-covenant.org/). By participating you agree to foster a welcoming and harassment-free environment for everyone.

---

## Prerequisites

â€¢ **.NET SDK 8.0** â€” the library and tests currently target `net8.0`. You can verify your installation with:

```bash
dotnet --version   # should print 8.x
```

â€¢ **Git** â€” any recent version.

â€¢ **DuckDB.NET.Data.Full** (along with EF Core) is restored automatically during build; no system-wide DuckDB install is required because the 'Full' package ships native binaries.

---

## Development Setup

```bash
git clone https://github.com/<you>/EnergyExemplar.EFCore.Duckdb.Extensions.git
cd EnergyExemplar.EFCore.Duckdb.Extensions

# Restore packages & build everything
 dotnet build                       # builds Source + Tests

# Run the full test-suite (NUnit)
 dotnet test
```

> **Tip:** VS Code users can load the workspace at the root and press <kbd>F5</kbd> to run tests directly from the Test Explorer.

---

## Branch & Commit Conventions

â€¢ **Branch names** follow the pattern `type/short-description`, e.g. `feat/rewrite-like-operator` or `fix/parquet-nullable-date`.

â€¢ **Commit messages** use [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/):

```
<type>[optional scope]: <short summary>

[optional body]
[optional footers]
```

Examples:

* `feat: expose UseDuckDb(DbConnection) overload`
* `fix(sql): correct random() aliasing rule`
* `docs: improve README quick-start`

These conventions make the change-log & semantic versioning much easier to automate.

---

## Coding Guidelines

| Topic | Guideline |
|-------|-----------|
| C# Style | Run `dotnet format` before committing â€“ this applies the *.editorconfig* rules automatically. |
| Nullable | The project has **nullable reference types** enabled â€“ avoid `!` suppression unless absolutely necessary. |
| Public API | Public surface changes must be accompanied by XML docs and a line in *README.md* summarising the feature. |
| Performance | DuckDB is columnar â€“ favour set-based operations and avoid per-row loops in critical paths. |
| Dependencies | Stick to the **lowest** package versions that still provide the required features (currently EF Core 8.0.6 & DuckDB.NET.Data.Full 1.2.1). |

---

## SQL Rewrite Rules

A cornerstone of this library is translating SQLite-flavoured SQL generated by EF Core into DuckDB-compatible syntax. If you need to fix a translation issue:

1. Add a new rule in `Source/DuckDb/Internals/DuckSqlRules.cs`.
2. If the transformation is non-trivial consider creating a helper in `RewriterHelpers.cs`.
3. Register the rule in `RewritePipeline.Default` **in logical order** (most selective first).
4. Add **unit tests** that trigger the EF Core SQL which your rule intends to fix. Place them under `Tests/DuckDb/`.

> Remember: each rule should be **pure** (no external state) and fast â€“ the rewrite pipeline runs for every query.

---

## Testing Guidelines

The test-suite uses **NUnit 3** and executes against `net8.0`.

| Kind | Where | Notes |
|------|-------|-------|
| Unit | `Tests/DuckDb/*Tests.cs` | Fast, no outside resources. |
| Integration | Same folder | May read the sample *test.parquet* file shipped in the repo. |

Run everything with:

```bash
 dotnet test --collect:"XPlat Code Coverage"
```

Coverage reports (if `coverlet.collector` is installed) are produced in *Tests/TestResults*.

---

## Pull-Request Checklist

Before opening a PR, please make sure that:

- [ ] `dotnet build` succeeds on your machine.
- [ ] `dotnet test` passes **without** failures.
- [ ] `dotnet format --verify-no-changes` returns no diffs.
- [ ] Public API changes are documented.
- [ ] You squashed or rebased to keep the history clean.

Once ready, open the PR against **`main`** (unless instructed otherwise). A maintainer will review your changes â€“ we aim to provide feedback within a few business days.

---

Thanks again for considering a contribution! Your time and expertise are greatly appreciated. ðŸ’™ 